<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novelty Number Plate Order Form</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font and theme styling -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Dark background for contrast */
        }
        /* Custom styling for focus states */
        input:focus, select:focus, textarea:focus {
            border-color: #f87171 !important; /* Red focus ring */
            box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.5) !important;
            outline: none;
        }
        /* Custom radio/checkbox styling to use theme color (red) */
        input[type="radio"], input[type="checkbox"] {
            accent-color: #ef4444;
        }
        /* Simple spinner for loading state */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Order Form Container -->
    <div class="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 md:p-10 border-t-8 border-red-600">

        <header class="text-center mb-8" id="form-header">
            <h1 class="text-3xl md:text-4xl font-extrabold text-red-600">Novelty Number Plate Order Form</h1>
            <p class="mt-2 text-lg text-gray-500">Please complete all required sections to place your order.</p>
        </header>

        <!-- Form container that will be replaced by success message -->
        <div id="form-content">
            <form id="plate-order-form" class="space-y-8">

                <!-- 1. Customer Details Section -->
                <fieldset class="border border-gray-200 p-4 rounded-lg bg-gray-50 shadow-sm">
                    <legend class="text-xl font-bold text-gray-800 px-2">1. Customer Contact</legend>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Customer Name -->
                        <div>
                            <label for="full_name" class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                            <input
                                type="text"
                                name="Customer Name"
                                id="full_name"
                                required
                                placeholder="Full Name (Print)"
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>

                        <!-- Contact Number -->
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Contact Number</label>
                            <input
                                type="tel"
                                name="Contact Number"
                                id="phone"
                                required
                                placeholder="(123) 456-7890"
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>

                        <!-- Email Address -->
                        <div class="md:col-span-2">
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input
                                type="email"
                                name="Email Address"
                                id="email"
                                required
                                placeholder="you@example.com (Required for payment details)"
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>
                        
                        <!-- Date of Order -->
                        <div class="md:col-span-2">
                            <label for="date_of_order" class="block text-sm font-medium text-gray-700 mb-1">Date of Order</label>
                            <input
                                type="date"
                                name="Date of Order"
                                id="date_of_order"
                                required
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>
                    </div>
                </fieldset>

                <!-- 2. Plate Details Section -->
                <fieldset class="border border-red-400 p-4 rounded-lg bg-red-50 shadow-sm">
                    <legend class="text-xl font-bold text-red-700 px-2">2. Plate Details</legend>

                    <!-- Text to be Stamped -->
                    <div class="mb-6">
                        <label for="stamped_text" class="block text-sm font-medium text-gray-700 mb-1">
                            Text / Combination Requested (Letters & Numbers, Max 6 Characters)
                        </label>
                        <input
                            type="text"
                            name="Plate Text"
                            id="stamped_text"
                            maxlength="6"
                            required
                            placeholder="MAX 6 CHARACTERS"
                            class="w-full p-3 border border-red-300 rounded-lg text-xl tracking-wider font-mono uppercase text-red-700 font-bold"
                        >
                    </div>

                    <!-- Plate Type & Price -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Plate Type & Price (Select One)</label>
                        <div class="space-y-2">
                            <!-- Standard Plate -->
                            <div class="flex items-center p-2 bg-white rounded-lg border border-red-200">
                                <input type="radio" id="standard_plate" name="Plate Type & Price" value="Standard Plate – $280" required class="w-5 h-5">
                                <label for="standard_plate" class="ml-3 text-base text-gray-800 flex justify-between w-full">
                                    <span>Standard Plate</span>
                                    <span class="font-semibold text-red-600">$280</span>
                                </label>
                            </div>
                            <!-- Slimline Plate -->
                            <div class="flex items-center p-2 bg-white rounded-lg border border-red-200">
                                <input type="radio" id="slimline_plate" name="Plate Type & Price" value="Slimline Plate – $250" class="w-5 h-5">
                                <label for="slimline_plate" class="ml-3 text-base text-gray-800 flex justify-between w-full">
                                    <span>Slimline Plate</span>
                                    <span class="font-semibold text-red-600">$250</span>
                                </label>
                            </div>
                            <!-- Motorcycle Plate -->
                            <div class="flex items-center p-2 bg-white rounded-lg border border-red-200">
                                <input type="radio" id="motorcycle_plate" name="Plate Type & Price" value="Motorcycle Plate – $200" class="w-5 h-5">
                                <label for="motorcycle_plate" class="ml-3 text-base text-gray-800 flex justify-between w-full">
                                    <span>Motorcycle Plate</span>
                                    <span class="font-semibold text-red-600">$200</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Plate Colour -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Plate Colour (Select One)</label>
                        <div class="flex flex-wrap gap-4">
                            <!-- White on Black -->
                            <div class="flex items-center p-2 bg-white rounded-lg border border-red-200">
                                <input type="radio" id="white_on_black" name="Plate Colour" value="White on Black" required class="w-5 h-5">
                                <label for="white_on_black" class="ml-2 text-base text-gray-800">White on Black</label>
                            </div>
                            <!-- Blue on White -->
                            <div class="flex items-center p-2 bg-white rounded-lg border border-red-200">
                                <input type="radio" id="blue_on_white" name="Plate Colour" value="Blue on White" class="w-5 h-5">
                                <label for="blue_on_white" class="ml-2 text-base text-gray-800">Blue on White</label>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- 3. Terms & Agreement Section -->
                <fieldset class="border border-gray-400 p-4 rounded-lg bg-white shadow-lg">
                    <legend class="text-xl font-bold text-gray-800 px-2">3. Payment Terms & Disclaimer</legend>

                    <!-- Payment Terms -->
                    <div class="mb-6 border-b pb-4">
                        <h3 class="font-bold text-lg mb-2 text-red-600">Payment Terms</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-1 ml-4">
                            <li>A 50% **deposit is required** when submitting this order.</li>
                            <li>Manufacturing will **not begin** until deposit is received.</li>
                            <li>The final balance is payable **upon collection** of the plates.</li>
                        </ul>
                    </div>

                    <!-- Disclaimer -->
                    <div class="mb-6 border-b pb-4">
                        <h3 class="font-bold text-lg mb-2 text-red-600">Terms & Disclaimer</h3>
                        <ul class="list-disc list-inside text-gray-600 space-y-1 ml-4">
                            <li>These plates are **novelty items only**.</li>
                            <li>They are **not registered** with VicRoads or any road authority.</li>
                            <li>They must **not be used** on public roads or vehicles.</li>
                            <li>Use of novelty plates on a vehicle in public is **against the law**.</li>
                            <li>The seller accepts **no responsibility** for misuse of the plates once purchased.</li>
                        </ul>
                    </div>

                    <!-- Customer Agreement Checkbox -->
                    <div class="bg-yellow-100 p-4 rounded-lg border border-yellow-300">
                        <label for="customer_agreement" class="flex items-start text-base font-medium text-gray-800 cursor-pointer">
                            <input type="checkbox" id="customer_agreement" name="Customer Agreement" value="I agree to the terms and disclaimer" required class="w-6 h-6 mt-0.5 mr-3 flex-shrink-0">
                            I, the undersigned, confirm that I **understand and agree** to the above disclaimer and payment terms.
                        </label>
                    </div>
                    
                    <!-- Printed Name and Date -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name_print" class="block text-sm font-medium text-gray-700 mb-1">Name (Print) - Required</label>
                            <input
                                type="text"
                                name="Agreement: Name (Print)"
                                id="name_print"
                                required
                                placeholder="Your Name Printed"
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>
                        <div>
                            <label for="agreement_date" class="block text-sm font-medium text-gray-700 mb-1">Date - Required</label>
                            <input
                                type="date"
                                name="Agreement: Date"
                                id="agreement_date"
                                required
                                class="w-full p-3 border border-gray-300 rounded-lg"
                            >
                        </div>
                    </div>

                </fieldset>

                <!-- Submit Button -->
                <button
                    type="submit"
                    id="submit-button"
                    class="w-full flex justify-center items-center py-4 px-4 border border-transparent rounded-lg shadow-xl text-xl font-bold text-white bg-red-600 hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-[1.01] focus:ring-4 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-100 disabled:bg-red-400"
                >
                    Submit Order
                </button>
                
                <p class="mt-8 text-center text-sm text-gray-500">
                    Your order will be securely saved. Once saved, you can access the data through the Firebase Console.
                </p>
                <div id="message-container" class="mt-4 text-center text-red-600 font-semibold hidden"></div>

            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, setDoc, doc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set log level to see Firebase operations in the console
        setLogLevel('Debug');

        // --- GLOBAL VARIABLES (Provided by the environment) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- FIREBASE INITIALIZATION ---
        let app;
        let db;
        let auth;
        let userId = 'anonymous';

        async function initFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in using the provided token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser?.uid || 'anonymous-user';
                console.log("Firebase initialized successfully. User ID:", userId);

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                // Display error to the user if auth fails
                const errorMsg = document.getElementById('message-container');
                errorMsg.textContent = "Error: Could not connect to the database. Please reload.";
                errorMsg.classList.remove('hidden');
                document.getElementById('submit-button').disabled = true;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            
            const form = document.getElementById('plate-order-form');
            const formContent = document.getElementById('form-content');
            const submitButton = document.getElementById('submit-button');
            const messageContainer = document.getElementById('message-container');
            
            // Defines the path where public orders will be stored for easy retrieval
            const ORDER_COLLECTION_PATH = `artifacts/${appId}/public/data/novelty_plate_orders`;

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!db) {
                    messageContainer.textContent = "Database not ready. Please wait a moment and try again.";
                    messageContainer.classList.remove('hidden');
                    return;
                }
                
                const formData = new FormData(form);
                // Convert FormData to a simple object for Firestore
                const orderData = Object.fromEntries(formData.entries());
                
                // Add metadata
                orderData.timestamp = new Date().toISOString();
                orderData.status = "New Order (Pending Deposit)";
                orderData.submittedBy = userId;

                // Show loading state
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="spinner"></span> Saving Order...';
                messageContainer.classList.add('hidden'); // Clear previous messages

                try {
                    // Save the order to Firestore
                    const docRef = await addDoc(collection(db, ORDER_COLLECTION_PATH), orderData);
                    
                    // --- SUCCESS ---
                    console.log("Order saved successfully with ID:", docRef.id);

                    const successHTML = `
                        <div class="text-center p-8 bg-green-50 border border-green-300 rounded-lg shadow-inner">
                            <svg class="mx-auto h-16 w-16 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <h2 class="mt-4 text-2xl font-bold text-green-700">Order Submitted Successfully!</h2>
                            <p class="mt-2 text-gray-600">
                                Thank you for your order. The details have been **securely saved to the database**.
                                You can now check your Firebase Console under the collection: 
                                <code class="font-mono text-sm bg-green-200 px-1 rounded">${docRef.path}</code>
                                to retrieve the order and contact the customer.
                            </p>
                        </div>
                    `;
                    // Replace the form content with the success message
                    formContent.innerHTML = successHTML;

                } catch (error) {
                    // --- FAILURE ---
                    console.error('Firestore Submission Error:', error);
                    messageContainer.textContent = `Error saving order: ${error.message}. Check the console for details.`;
                    messageContainer.classList.remove('hidden');
                    
                    // Restore button state on failure
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Submit Order';
                }
            });
        });
    </script>
</body>
</html>